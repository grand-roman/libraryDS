---
title: 'Аналитикам: большая шпаргалка по Pandas'
author: Алексей Куличевский
date: '2020-03-25'
slug: аналитикам-большая-шпаргалка-по-pandas
categories:
  - python
tags:
  - pandas
images: ~
---
```{r setup, include=FALSE}
library(reticulate)
use_python("/usr/local/bin/python")
```

## Что такое Pandas и зачем он нужен
Pandas — это библиотека для работы с данными на Python. Она упрощает жизнь аналитикам: где раньше использовалось 10 строк кода теперь хватит одной.

Например, чтобы прочитать данные из csv, в стандартном Python надо сначала решить, как хранить данные, затем открыть файл, прочитать его построчно, отделить значения друг от друга и очистить данные от специальных символов.
```
> with open('file.csv') as f:
...    content = f.readlines()
...    content = [x.split(',').replace('\n','') for x in content]
```
В Pandas всё проще. Во-первых, не нужно думать, как будут храниться данные — они лежат в датафрейме. Во-вторых, достаточно написать одну команду:
```
> data = pd.read_csv('file.csv')
```
Pandas добавляет в Python новые структуры данных — серии и датафреймы. Расскажу, что это такое.

## Структуры данных: серии и датафреймы
Серии — одномерные массивы данных. Они очень похожи на списки, но отличаются по поведению — например, операции применяются к списку целиком, а в сериях — поэлементно.

То есть, если список умножить на 2, получите тот же список, повторенный 2 раза.

```{python}
vector = [1, 2, 3]
vector * 2
```
А если умножить серию, ее длина не изменится, а вот элементы удвоятся.
```{python}
import pandas as pd
series = pd.Series([1, 2, 3])
series * 2
```
Обратите внимание на первый столбик вывода. Это индекс, в котором хранятся адреса каждого элемента серии. Каждый элемент потом можно получать, обратившись по нужному адресу.
```{python}
series = pd.Series(['foo', 'bar'])
series[0]
```
Еще одно отличие серий от списков — в качестве индексов можно использовать произвольные значения, это делает данные нагляднее. Представим, что мы анализируем помесячные продажи. Используем в качестве индексов названия месяцев, значениями будет выручка:
```{python}
months = ['jan', 'feb', 'mar', 'apr']
sales = [100, 200, 300, 400]
data = pd.Series(data=sales, index=months)
data
```
Теперь можем получать значения каждого месяца:
```{python}
data['feb']
```
Так как серии — одномерный массив данных, в них удобно хранить измерения по одному. На практике удобнее группировать данные вместе. Например, если мы анализируем помесячные продажи, полезно видеть не только выручку, но и количество проданных товаров, количество новых клиентов и средний чек. Для этого отлично подходят датафреймы.
Датафреймы — это таблицы. У их есть строки, колонки и ячейки.
Технически, колонки датафреймов — это серии. Поскольку в колонках обычно описывают одни и те же объекты, то все колонки делят один и тот же индекс:
```{python}
months = ['jan', 'feb', 'mar', 'apr']
sales = {
  'revenue':     [100, 200, 300, 400],
  'items_sold':  [23, 43, 55, 65],
  'new_clients': [10, 20, 30, 40]
  }
sales_df = pd.DataFrame(data=sales, index=months)
sales_df
```
Объясню, как создавать датафреймы и загружать в них данные.
## Создаем датафреймы и загружаем данные
Бывает, что мы не знаем, что собой представляют данные, и не можем задать структуру заранее. Тогда удобно создать пустой датафрейм и позже наполнить его данными.
